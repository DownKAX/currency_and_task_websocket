2025-04-10 19:29:56,436 - app.api.middleware.middleware - INFO - Incoming request: GET /
2025-04-10 19:29:56,436 - app.api.middleware.middleware - INFO - Outgoing response code: 404
2025-04-10 19:29:57,499 - app.api.middleware.middleware - INFO - Incoming request: GET /favicon.ico
2025-04-10 19:29:57,499 - app.api.middleware.middleware - INFO - Outgoing response code: 404
2025-04-11 18:40:27,981 - app.api.middleware.middleware - INFO - Incoming request: GET /
2025-04-11 18:40:27,982 - app.api.middleware.middleware - INFO - Outgoing response code: 404
2025-04-11 18:40:29,365 - app.api.middleware.middleware - INFO - Incoming request: GET /favicon.ico
2025-04-11 18:40:29,365 - app.api.middleware.middleware - INFO - Outgoing response code: 404
2025-04-11 18:40:46,872 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
2025-04-11 18:40:46,879 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
Traceback (most recent call last):
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 172, in execute
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 323, in _handle_exception
    raise error
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 154, in execute
    self.await_(_cursor.execute(operation, parameters))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
sqlite3.OperationalError: no such table: users

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\app\api\middleware\middleware.py", line 16, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\app\api\endpoints\users.py", line 28, in login
    user: [dict | None] = await UsersService.get_by_username(self=user_service, username=credentials.username)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\app\service\users_service.py", line 30, in get_by_username
    data = await self.uow.model.find_one(username=username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\app\repositories\base_repository.py", line 50, in find_one
    result = await self.session.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 172, in execute
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 323, in _handle_exception
    raise error
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 154, in execute
    self.await_(_cursor.execute(operation, parameters))
    ~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\pythonProject\venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: users
[SQL: SELECT users.id, users.username, users.password, users.register_date, users.role 
FROM users 
WHERE users.username = ?]
[parameters: ('moderator',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-04-11 18:41:02,292 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
2025-04-11 18:41:02,537 - app.api.middleware.middleware - INFO - Outgoing response code: 200
2025-04-11 18:41:10,789 - app.api.middleware.middleware - INFO - Incoming request: DELETE /tasks/delete_task
2025-04-11 18:41:10,800 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 18:41:27 - app.api.middleware.middleware - INFO - Incoming request: PUT /auth/register
08-10-2025 18:41:27 - app.api.middleware.middleware - INFO - Outgoing response code: 405
08-10-2025 18:41:33 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 18:41:33 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 59, in wrapped_app
    |     response = await handler(conn, exc)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\main.py", line 23, in validation_exception_handler
    |     if exc._errors[0].get('loc')[1] == 'session_token':
    |        ~~~~~~~~~~~~~~~~~~~~~~~~~^^^
    | IndexError: tuple index out of range
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 59, in wrapped_app
    response = await handler(conn, exc)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\main.py", line 23, in validation_exception_handler
    if exc._errors[0].get('loc')[1] == 'session_token':
       ~~~~~~~~~~~~~~~~~~~~~~~~~^^^
IndexError: tuple index out of range
08-10-2025 18:42:31 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 18:42:31 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 59, in wrapped_app
    |     response = await handler(conn, exc)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\main.py", line 24, in validation_exception_handler
    |     if exc._errors[0].get('loc')[1] == 'session_token':
    |        ~~~~~~~~~~~~~~~~~~~~~~~~~^^^
    | IndexError: tuple index out of range
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 59, in wrapped_app
    response = await handler(conn, exc)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\main.py", line 24, in validation_exception_handler
    if exc._errors[0].get('loc')[1] == 'session_token':
       ~~~~~~~~~~~~~~~~~~~~~~~~~^^^
IndexError: tuple index out of range
08-10-2025 18:42:59 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 18:42:59 - app.api.middleware.middleware - INFO - Outgoing response code: 422
08-10-2025 18:44:13 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 18:44:13 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 18:45:53 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 18:45:54 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 18:52:08 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 18:52:08 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 18:52:32 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 18:52:32 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 18:52:58 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 18:52:58 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 18:53:28 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 18:53:28 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 22, in register
    |     return await service.add_user(user=user_data)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\service\users_service.py", line 17, in add_user
    |     user_from_db = await self.uow.model.add_one(user_dict) #метод возвращает добавленные данные, записываем их в переменную
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\repositories\base_repository.py", line 41, in add_one
    |     except IntegrityError: #при случае нарушения уникальности данных
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 1462, in scalar_one
    |     return self._only_one_row(
    |            ~~~~~~~~~~~~~~~~~~^
    |         raise_for_second_row=True, raise_for_none=True, scalar=True
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 749, in _only_one_row
    |     row: Optional[_InterimRowType[Any]] = onerow(hard_close=True)
    |                                           ~~~~~~^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2255, in _fetchone_impl
    |     self._raise_hard_closed()
    |     ~~~~~~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2241, in _raise_hard_closed
    |     raise exc.ResourceClosedError("This result object is closed.")
    | sqlalchemy.exc.ResourceClosedError: This result object is closed.
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 22, in register
    return await service.add_user(user=user_data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\service\users_service.py", line 17, in add_user
    user_from_db = await self.uow.model.add_one(user_dict) #метод возвращает добавленные данные, записываем их в переменную
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\repositories\base_repository.py", line 41, in add_one
    except IntegrityError: #при случае нарушения уникальности данных
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 1462, in scalar_one
    return self._only_one_row(
           ~~~~~~~~~~~~~~~~~~^
        raise_for_second_row=True, raise_for_none=True, scalar=True
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 749, in _only_one_row
    row: Optional[_InterimRowType[Any]] = onerow(hard_close=True)
                                          ~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2255, in _fetchone_impl
    self._raise_hard_closed()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2241, in _raise_hard_closed
    raise exc.ResourceClosedError("This result object is closed.")
sqlalchemy.exc.ResourceClosedError: This result object is closed.
08-10-2025 18:54:01 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 18:54:01 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 22, in register
    |     return await service.add_user(user=user_data)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\service\users_service.py", line 17, in add_user
    |     user_from_db = await self.uow.model.add_one(user_dict) #метод возвращает добавленные данные, записываем их в переменную
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\repositories\base_repository.py", line 41, in add_one
    |     except IntegrityError: #при случае нарушения уникальности данных
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 1462, in scalar_one
    |     return self._only_one_row(
    |            ~~~~~~~~~~~~~~~~~~^
    |         raise_for_second_row=True, raise_for_none=True, scalar=True
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 749, in _only_one_row
    |     row: Optional[_InterimRowType[Any]] = onerow(hard_close=True)
    |                                           ~~~~~~^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2255, in _fetchone_impl
    |     self._raise_hard_closed()
    |     ~~~~~~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2241, in _raise_hard_closed
    |     raise exc.ResourceClosedError("This result object is closed.")
    | sqlalchemy.exc.ResourceClosedError: This result object is closed.
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 22, in register
    return await service.add_user(user=user_data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\service\users_service.py", line 17, in add_user
    user_from_db = await self.uow.model.add_one(user_dict) #метод возвращает добавленные данные, записываем их в переменную
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\repositories\base_repository.py", line 41, in add_one
    except IntegrityError: #при случае нарушения уникальности данных
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 1462, in scalar_one
    return self._only_one_row(
           ~~~~~~~~~~~~~~~~~~^
        raise_for_second_row=True, raise_for_none=True, scalar=True
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 749, in _only_one_row
    row: Optional[_InterimRowType[Any]] = onerow(hard_close=True)
                                          ~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2255, in _fetchone_impl
    self._raise_hard_closed()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2241, in _raise_hard_closed
    raise exc.ResourceClosedError("This result object is closed.")
sqlalchemy.exc.ResourceClosedError: This result object is closed.
08-10-2025 18:54:02 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 18:54:03 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 22, in register
    |     return await service.add_user(user=user_data)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\service\users_service.py", line 17, in add_user
    |     user_from_db = await self.uow.model.add_one(user_dict) #метод возвращает добавленные данные, записываем их в переменную
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\repositories\base_repository.py", line 41, in add_one
    |     except IntegrityError: #при случае нарушения уникальности данных
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 1462, in scalar_one
    |     return self._only_one_row(
    |            ~~~~~~~~~~~~~~~~~~^
    |         raise_for_second_row=True, raise_for_none=True, scalar=True
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 749, in _only_one_row
    |     row: Optional[_InterimRowType[Any]] = onerow(hard_close=True)
    |                                           ~~~~~~^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2255, in _fetchone_impl
    |     self._raise_hard_closed()
    |     ~~~~~~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2241, in _raise_hard_closed
    |     raise exc.ResourceClosedError("This result object is closed.")
    | sqlalchemy.exc.ResourceClosedError: This result object is closed.
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 22, in register
    return await service.add_user(user=user_data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\service\users_service.py", line 17, in add_user
    user_from_db = await self.uow.model.add_one(user_dict) #метод возвращает добавленные данные, записываем их в переменную
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\repositories\base_repository.py", line 41, in add_one
    except IntegrityError: #при случае нарушения уникальности данных
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 1462, in scalar_one
    return self._only_one_row(
           ~~~~~~~~~~~~~~~~~~^
        raise_for_second_row=True, raise_for_none=True, scalar=True
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 749, in _only_one_row
    row: Optional[_InterimRowType[Any]] = onerow(hard_close=True)
                                          ~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2255, in _fetchone_impl
    self._raise_hard_closed()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2241, in _raise_hard_closed
    raise exc.ResourceClosedError("This result object is closed.")
sqlalchemy.exc.ResourceClosedError: This result object is closed.
08-10-2025 18:54:04 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 18:54:04 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 22, in register
    |     return await service.add_user(user=user_data)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\service\users_service.py", line 17, in add_user
    |     user_from_db = await self.uow.model.add_one(user_dict) #метод возвращает добавленные данные, записываем их в переменную
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\repositories\base_repository.py", line 41, in add_one
    |     except IntegrityError: #при случае нарушения уникальности данных
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 1462, in scalar_one
    |     return self._only_one_row(
    |            ~~~~~~~~~~~~~~~~~~^
    |         raise_for_second_row=True, raise_for_none=True, scalar=True
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 749, in _only_one_row
    |     row: Optional[_InterimRowType[Any]] = onerow(hard_close=True)
    |                                           ~~~~~~^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2255, in _fetchone_impl
    |     self._raise_hard_closed()
    |     ~~~~~~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2241, in _raise_hard_closed
    |     raise exc.ResourceClosedError("This result object is closed.")
    | sqlalchemy.exc.ResourceClosedError: This result object is closed.
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 22, in register
    return await service.add_user(user=user_data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\service\users_service.py", line 17, in add_user
    user_from_db = await self.uow.model.add_one(user_dict) #метод возвращает добавленные данные, записываем их в переменную
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\repositories\base_repository.py", line 41, in add_one
    except IntegrityError: #при случае нарушения уникальности данных
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 1462, in scalar_one
    return self._only_one_row(
           ~~~~~~~~~~~~~~~~~~^
        raise_for_second_row=True, raise_for_none=True, scalar=True
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 749, in _only_one_row
    row: Optional[_InterimRowType[Any]] = onerow(hard_close=True)
                                          ~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2255, in _fetchone_impl
    self._raise_hard_closed()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2241, in _raise_hard_closed
    raise exc.ResourceClosedError("This result object is closed.")
sqlalchemy.exc.ResourceClosedError: This result object is closed.
08-10-2025 18:54:59 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 18:54:59 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 22, in register
    |     return await service.add_user(user=user_data)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\service\users_service.py", line 17, in add_user
    |     user_from_db = await self.uow.model.add_one(user_dict) #метод возвращает добавленные данные, записываем их в переменную
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\repositories\base_repository.py", line 41, in add_one
    |     except IntegrityError: #при случае нарушения уникальности данных
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 1462, in scalar_one
    |     return self._only_one_row(
    |            ~~~~~~~~~~~~~~~~~~^
    |         raise_for_second_row=True, raise_for_none=True, scalar=True
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 749, in _only_one_row
    |     row: Optional[_InterimRowType[Any]] = onerow(hard_close=True)
    |                                           ~~~~~~^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2255, in _fetchone_impl
    |     self._raise_hard_closed()
    |     ~~~~~~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2241, in _raise_hard_closed
    |     raise exc.ResourceClosedError("This result object is closed.")
    | sqlalchemy.exc.ResourceClosedError: This result object is closed.
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 22, in register
    return await service.add_user(user=user_data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\service\users_service.py", line 17, in add_user
    user_from_db = await self.uow.model.add_one(user_dict) #метод возвращает добавленные данные, записываем их в переменную
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\repositories\base_repository.py", line 41, in add_one
    except IntegrityError: #при случае нарушения уникальности данных
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 1462, in scalar_one
    return self._only_one_row(
           ~~~~~~~~~~~~~~~~~~^
        raise_for_second_row=True, raise_for_none=True, scalar=True
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 749, in _only_one_row
    row: Optional[_InterimRowType[Any]] = onerow(hard_close=True)
                                          ~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2255, in _fetchone_impl
    self._raise_hard_closed()
    ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\result.py", line 2241, in _raise_hard_closed
    raise exc.ResourceClosedError("This result object is closed.")
sqlalchemy.exc.ResourceClosedError: This result object is closed.
08-10-2025 19:06:57 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 19:06:57 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:07:52 - app.api.middleware.middleware - INFO - Incoming request: POST /aauth/login
08-10-2025 19:07:52 - app.api.middleware.middleware - INFO - Outgoing response code: 404
08-10-2025 19:07:59 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:07:59 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    |     tokens = await stamp_tokens(response, user, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 19, in stamp_tokens
    |     await add_session(username=user.get('username'),
    |                       refresh_token=session.refresh_token,
    |                       session=session.session)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    |     await r.hset(username, refresh_token, session.model_dump_json())
    |           ^^^^^^
    | AttributeError: 'NoneType' object has no attribute 'hset'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    tokens = await stamp_tokens(response, user, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 19, in stamp_tokens
    await add_session(username=user.get('username'),
                      refresh_token=session.refresh_token,
                      session=session.session)
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    await r.hset(username, refresh_token, session.model_dump_json())
          ^^^^^^
AttributeError: 'NoneType' object has no attribute 'hset'
08-10-2025 19:08:13 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/register
08-10-2025 19:08:14 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:08:17 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:08:17 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    |     tokens = await stamp_tokens(response, user, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 19, in stamp_tokens
    |     await add_session(username=user.get('username'),
    |                       refresh_token=session.refresh_token,
    |                       session=session.session)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    |     await r.hset(username, refresh_token, session.model_dump_json())
    |           ^^^^^^
    | AttributeError: 'NoneType' object has no attribute 'hset'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    tokens = await stamp_tokens(response, user, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 19, in stamp_tokens
    await add_session(username=user.get('username'),
                      refresh_token=session.refresh_token,
                      session=session.session)
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    await r.hset(username, refresh_token, session.model_dump_json())
          ^^^^^^
AttributeError: 'NoneType' object has no attribute 'hset'
08-10-2025 19:08:48 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:08:51 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    |     tokens = await stamp_tokens(response, user, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 23, in stamp_tokens
    |     await set_tokens(response, tokens=for_return)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 35, in set_tokens
    |     response.set_cookie(key='session_token', value=tokens.session_token, secure=True, httponly=True)
    |                                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 984, in __getattr__
    |     raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
    | AttributeError: 'Tokens' object has no attribute 'session_token'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    tokens = await stamp_tokens(response, user, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 23, in stamp_tokens
    await set_tokens(response, tokens=for_return)
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 35, in set_tokens
    response.set_cookie(key='session_token', value=tokens.session_token, secure=True, httponly=True)
                                                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 984, in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}')
AttributeError: 'Tokens' object has no attribute 'session_token'
08-10-2025 19:09:13 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:09:16 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:09:54 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:09:54 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:10:22 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:10:22 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:10:36 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:10:36 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:10:48 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:10:48 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:10:56 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:10:56 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:11:13 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:11:13 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:11:41 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:11:41 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:12:03 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:12:03 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:12:19 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:12:19 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:12:53 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:12:53 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:13:12 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:13:12 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:14:06 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:14:06 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:14:20 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:14:20 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:14:37 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:14:40 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:15:20 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:15:20 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:15:45 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:15:45 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:17:43 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:17:43 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 38, in check_token
    |     tokens: Tokens = await get_tokens(request)
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 32, in get_tokens
    |     return Tokens(refresh_token=refresh_token, access_token=session_token)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 243, in __init__
    |     validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
    | pydantic_core._pydantic_core.ValidationError: 1 validation error for Tokens
    | access_token
    |   Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    |     For further information visit https://errors.pydantic.dev/2.11/v/string_type
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 38, in check_token
    tokens: Tokens = await get_tokens(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 32, in get_tokens
    return Tokens(refresh_token=refresh_token, access_token=session_token)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 243, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for Tokens
access_token
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
08-10-2025 19:18:15 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:18:24 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:19:54 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:19:56 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:20:02 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:20:12 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:20:41 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:21:31 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:21:33 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:22:07 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:22:08 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:22:22 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:22:22 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:22:30 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:22:30 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:22:34 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:22:34 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:22:39 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:22:39 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:22:46 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:22:46 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:22:50 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:22:50 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:22:56 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:22:56 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:22:58 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:22:58 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:22:59 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:22:59 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:23:00 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:23:00 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:23:30 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:23:32 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:23:48 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:23:50 - app.api.middleware.middleware - INFO - Outgoing response code: 401
08-10-2025 19:24:57 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:24:59 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 42, in check_token
    |     tokens = await update_tokens(response, request, user_agent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 53, in update_tokens
    |     token = await stamp_tokens(response, session_from_redis.username, user_agent)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 17, in stamp_tokens
    |     session = await create_session(useragent, user)
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 46, in create_session
    |     session = Session(username=user.get('username'), useragent=useragent)
    |                                ^^^^^^^^
    | AttributeError: 'str' object has no attribute 'get'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 42, in check_token
    tokens = await update_tokens(response, request, user_agent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 53, in update_tokens
    token = await stamp_tokens(response, session_from_redis.username, user_agent)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 17, in stamp_tokens
    session = await create_session(useragent, user)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 46, in create_session
    session = Session(username=user.get('username'), useragent=useragent)
                               ^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
08-10-2025 19:26:41 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:26:44 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:26:51 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:26:51 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:26:58 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:26:58 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 42, in check_token
    |     tokens = await update_tokens(response, request, user_agent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 53, in update_tokens
    |     token = await stamp_tokens(response, session_from_redis.username, user_agent)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 17, in stamp_tokens
    |     session = await create_session(useragent, user)
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 46, in create_session
    |     session = Session(username=user.get('username'), useragent=useragent)
    |                                ^^^^^^^^
    | AttributeError: 'str' object has no attribute 'get'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 42, in check_token
    tokens = await update_tokens(response, request, user_agent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 53, in update_tokens
    token = await stamp_tokens(response, session_from_redis.username, user_agent)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 17, in stamp_tokens
    session = await create_session(useragent, user)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 46, in create_session
    session = Session(username=user.get('username'), useragent=useragent)
                               ^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
08-10-2025 19:29:19 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
08-10-2025 19:29:21 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 42, in check_token
    |     tokens = await update_tokens(response, request, user_agent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 53, in update_tokens
    |     token = await stamp_tokens(response, session_from_redis.username, user_agent)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 18, in stamp_tokens
    |     session_token = await create_access_token(user)
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 39, in create_access_token
    |     data.pop('register_date')
    |     ^^^^^^^^
    | AttributeError: 'str' object has no attribute 'pop'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 42, in check_token
    tokens = await update_tokens(response, request, user_agent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 53, in update_tokens
    token = await stamp_tokens(response, session_from_redis.username, user_agent)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 18, in stamp_tokens
    session_token = await create_access_token(user)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 39, in create_access_token
    data.pop('register_date')
    ^^^^^^^^
AttributeError: 'str' object has no attribute 'pop'
08-10-2025 19:31:01 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:31:03 - app.api.middleware.middleware - INFO - Outgoing response code: 200
08-10-2025 19:38:57 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:38:58 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    |     tokens = await stamp_tokens(response, user, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 18, in stamp_tokens
    |     session = await create_session(useragent, user)
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 48, in create_session
    |     session = Session(username=user.get('username'), useragent=useragent)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 243, in __init__
    |     validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
    | pydantic_core._pydantic_core.ValidationError: 1 validation error for Session
    | userdata
    |   Field required [type=missing, input_value={'username': 'elina', 'us...'PostmanRuntime/7.48.0'}, input_type=dict]
    |     For further information visit https://errors.pydantic.dev/2.11/v/missing
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    tokens = await stamp_tokens(response, user, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 18, in stamp_tokens
    session = await create_session(useragent, user)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 48, in create_session
    session = Session(username=user.get('username'), useragent=useragent)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 243, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for Session
userdata
  Field required [type=missing, input_value={'username': 'elina', 'us...'PostmanRuntime/7.48.0'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
08-10-2025 19:39:39 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
08-10-2025 19:39:39 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    |     tokens = await stamp_tokens(response, user, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 20, in stamp_tokens
    |     await add_session(userdata=json.dumps(user),
    |                                ~~~~~~~~~~^^^^^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\json\__init__.py", line 231, in dumps
    |     return _default_encoder.encode(obj)
    |            ~~~~~~~~~~~~~~~~~~~~~~~^^^^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\json\encoder.py", line 200, in encode
    |     chunks = self.iterencode(o, _one_shot=True)
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\json\encoder.py", line 261, in iterencode
    |     return _iterencode(o, 0)
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\json\encoder.py", line 180, in default
    |     raise TypeError(f'Object of type {o.__class__.__name__} '
    |                     f'is not JSON serializable')
    | TypeError: Object of type datetime is not JSON serializable
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    tokens = await stamp_tokens(response, user, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 20, in stamp_tokens
    await add_session(userdata=json.dumps(user),
                               ~~~~~~~~~~^^^^^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\json\__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           ~~~~~~~~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\json\encoder.py", line 200, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\json\encoder.py", line 261, in iterencode
    return _iterencode(o, 0)
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\json\encoder.py", line 180, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
                    f'is not JSON serializable')
TypeError: Object of type datetime is not JSON serializable
11-10-2025 17:04:08 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:04:08 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    |     tokens = await stamp_tokens(response, user, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 17, in stamp_tokens
    |     session = await create_session(useragent, user)
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 47, in create_session
    |     session = Session(username=user.get('username'), useragent=useragent)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 243, in __init__
    |     validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
    | pydantic_core._pydantic_core.ValidationError: 1 validation error for Session
    | userdata
    |   Field required [type=missing, input_value={'username': 'elina', 'us...'PostmanRuntime/7.48.0'}, input_type=dict]
    |     For further information visit https://errors.pydantic.dev/2.11/v/missing
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    tokens = await stamp_tokens(response, user, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 17, in stamp_tokens
    session = await create_session(useragent, user)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 47, in create_session
    session = Session(username=user.get('username'), useragent=useragent)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 243, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for Session
userdata
  Field required [type=missing, input_value={'username': 'elina', 'us...'PostmanRuntime/7.48.0'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
11-10-2025 17:05:03 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:05:04 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    |     tokens = await stamp_tokens(response, user, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 17, in stamp_tokens
    |     session = await create_session(useragent, user)
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 47, in create_session
    |     session = Session(username=user.get('username'), useragent=useragent)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 243, in __init__
    |     validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
    | pydantic_core._pydantic_core.ValidationError: 1 validation error for Session
    | userdata
    |   Field required [type=missing, input_value={'username': 'elina', 'us...'PostmanRuntime/7.48.0'}, input_type=dict]
    |     For further information visit https://errors.pydantic.dev/2.11/v/missing
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 33, in login
    tokens = await stamp_tokens(response, user, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 17, in stamp_tokens
    session = await create_session(useragent, user)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 47, in create_session
    session = Session(username=user.get('username'), useragent=useragent)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 243, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for Session
userdata
  Field required [type=missing, input_value={'username': 'elina', 'us...'PostmanRuntime/7.48.0'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
11-10-2025 17:05:20 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:05:22 - app.api.middleware.middleware - INFO - Outgoing response code: 200
11-10-2025 17:11:00 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:11:00 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    |     tokens = await stamp_tokens(response, userdata, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 19, in stamp_tokens
    |     session = await create_session(useragent, userdata)
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 48, in create_session
    |     userdata = msgpack.packb(userdata)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    |     return Packer(**kwargs).pack(o)
    |            ~~~~~~~~~~~~~~~~~~~~~^^^
    |   File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
    | TypeError: can not serialize 'datetime.datetime' object
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    tokens = await stamp_tokens(response, userdata, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 19, in stamp_tokens
    session = await create_session(useragent, userdata)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 48, in create_session
    userdata = msgpack.packb(userdata)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    return Packer(**kwargs).pack(o)
           ~~~~~~~~~~~~~~~~~~~~~^^^
  File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
TypeError: can not serialize 'datetime.datetime' object
11-10-2025 17:11:53 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:11:53 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    |     tokens = await stamp_tokens(response, userdata, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 21, in stamp_tokens
    |     session = await create_session(useragent, userdata)
    |               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 50, in create_session
    |     session = Session(userdata=userdata, useragent=useragent)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 243, in __init__
    |     validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
    | pydantic_core._pydantic_core.ValidationError: 1 validation error for Session
    | userdata
    |   Input should be a valid string, unable to parse raw data as a unicode string [type=string_unicode, input_value=b'\x82\xa8username\xa5elina\xa4role\xa4user', input_type=bytes]
    |     For further information visit https://errors.pydantic.dev/2.11/v/string_unicode
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    tokens = await stamp_tokens(response, userdata, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 21, in stamp_tokens
    session = await create_session(useragent, userdata)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 50, in create_session
    session = Session(userdata=userdata, useragent=useragent)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 243, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for Session
userdata
  Input should be a valid string, unable to parse raw data as a unicode string [type=string_unicode, input_value=b'\x82\xa8username\xa5elina\xa4role\xa4user', input_type=bytes]
    For further information visit https://errors.pydantic.dev/2.11/v/string_unicode
11-10-2025 17:12:24 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:12:24 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    |     tokens = await stamp_tokens(response, userdata, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 23, in stamp_tokens
    |     await add_session(userdata=userdata.get('username'),
    |                       refresh_token=session.refresh_token,
    |                       session=session.session)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    |     await r.hset(userdata, refresh_token, session.model_dump_json())
    |                                           ~~~~~~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 509, in model_dump_json
    |     return self.__pydantic_serializer__.to_json(
    |            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
    |         self,
    |         ^^^^^
    |     ...<11 lines>...
    |         serialize_as_any=serialize_as_any,
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ).decode()
    |     ^
    | pydantic_core._pydantic_core.PydanticSerializationError: Error serializing to JSON: invalid utf-8 sequence of 1 bytes from index 0
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    tokens = await stamp_tokens(response, userdata, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 23, in stamp_tokens
    await add_session(userdata=userdata.get('username'),
                      refresh_token=session.refresh_token,
                      session=session.session)
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    await r.hset(userdata, refresh_token, session.model_dump_json())
                                          ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 509, in model_dump_json
    return self.__pydantic_serializer__.to_json(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<11 lines>...
        serialize_as_any=serialize_as_any,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ).decode()
    ^
pydantic_core._pydantic_core.PydanticSerializationError: Error serializing to JSON: invalid utf-8 sequence of 1 bytes from index 0
11-10-2025 17:20:50 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:20:53 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    |     tokens = await stamp_tokens(response, userdata, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 23, in stamp_tokens
    |     await add_session(userdata=userdata.get('username'),
    |                       refresh_token=session.refresh_token,
    |                       session=session.session)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    |     await r.hset(userdata, refresh_token, session.model_dump())
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\redis\asyncio\client.py", line 677, in execute_command
    |     return await conn.retry.call_with_retry(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<4 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\redis\asyncio\retry.py", line 50, in call_with_retry
    |     return await do()
    |            ^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\redis\asyncio\client.py", line 651, in _send_command_parse_response
    |     await conn.send_command(*args)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\redis\asyncio\connection.py", line 560, in send_command
    |     self.pack_command(*args), check_health=kwargs.get("check_health", True)
    |     ~~~~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\redis\asyncio\connection.py", line 647, in pack_command
    |     for arg in map(self.encoder.encode, args):
    |                ~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\redis\_parsers\encoders.py", line 29, in encode
    |     raise DataError(
    |     ...<2 lines>...
    |     )
    | redis.exceptions.DataError: Invalid input of type: 'dict'. Convert to a bytes, string, int or float first.
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    tokens = await stamp_tokens(response, userdata, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 23, in stamp_tokens
    await add_session(userdata=userdata.get('username'),
                      refresh_token=session.refresh_token,
                      session=session.session)
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    await r.hset(userdata, refresh_token, session.model_dump())
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\redis\asyncio\client.py", line 677, in execute_command
    return await conn.retry.call_with_retry(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\redis\asyncio\retry.py", line 50, in call_with_retry
    return await do()
           ^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\redis\asyncio\client.py", line 651, in _send_command_parse_response
    await conn.send_command(*args)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\redis\asyncio\connection.py", line 560, in send_command
    self.pack_command(*args), check_health=kwargs.get("check_health", True)
    ~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\redis\asyncio\connection.py", line 647, in pack_command
    for arg in map(self.encoder.encode, args):
               ~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\redis\_parsers\encoders.py", line 29, in encode
    raise DataError(
    ...<2 lines>...
    )
redis.exceptions.DataError: Invalid input of type: 'dict'. Convert to a bytes, string, int or float first.
11-10-2025 17:23:44 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:23:44 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    |     tokens = await stamp_tokens(response, userdata, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 23, in stamp_tokens
    |     await add_session(userdata=userdata.get('username'),
    |                       refresh_token=session.refresh_token,
    |                       session=session.session)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    |     await r.hset(userdata, refresh_token, packb(session.model_dump()))
    |                                           ~~~~~^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    |     return Packer(**kwargs).pack(o)
    |            ~~~~~~~~~~~~~~~~~~~~~^^^
    |   File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
    | TypeError: can not serialize 'datetime.datetime' object
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    tokens = await stamp_tokens(response, userdata, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 23, in stamp_tokens
    await add_session(userdata=userdata.get('username'),
                      refresh_token=session.refresh_token,
                      session=session.session)
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    await r.hset(userdata, refresh_token, packb(session.model_dump()))
                                          ~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    return Packer(**kwargs).pack(o)
           ~~~~~~~~~~~~~~~~~~~~~^^^
  File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
TypeError: can not serialize 'datetime.datetime' object
11-10-2025 17:24:32 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:24:32 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    |     tokens = await stamp_tokens(response, userdata, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 24, in stamp_tokens
    |     await add_session(userdata=userdata.get('username'),
    |                       refresh_token=session.refresh_token,
    |                       session=session.session)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    |     await r.hset(userdata, refresh_token, packb(session.model_dump()))
    |                                           ~~~~~^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    |     return Packer(**kwargs).pack(o)
    |            ~~~~~~~~~~~~~~~~~~~~~^^^
    |   File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
    | TypeError: can not serialize 'datetime.datetime' object
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    tokens = await stamp_tokens(response, userdata, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 24, in stamp_tokens
    await add_session(userdata=userdata.get('username'),
                      refresh_token=session.refresh_token,
                      session=session.session)
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    await r.hset(userdata, refresh_token, packb(session.model_dump()))
                                          ~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    return Packer(**kwargs).pack(o)
           ~~~~~~~~~~~~~~~~~~~~~^^^
  File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
TypeError: can not serialize 'datetime.datetime' object
11-10-2025 17:26:39 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:26:39 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    |     tokens = await stamp_tokens(response, userdata, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 22, in stamp_tokens
    |     await add_session(userdata=userdata.get('username'),
    |                       refresh_token=session.refresh_token,
    |                       session=session.session)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    |     await r.hset(userdata, refresh_token, packb(session.model_dump()))
    |                                           ~~~~~^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    |     return Packer(**kwargs).pack(o)
    |            ~~~~~~~~~~~~~~~~~~~~~^^^
    |   File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
    | TypeError: can not serialize 'datetime.datetime' object
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    tokens = await stamp_tokens(response, userdata, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 22, in stamp_tokens
    await add_session(userdata=userdata.get('username'),
                      refresh_token=session.refresh_token,
                      session=session.session)
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    await r.hset(userdata, refresh_token, packb(session.model_dump()))
                                          ~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    return Packer(**kwargs).pack(o)
           ~~~~~~~~~~~~~~~~~~~~~^^^
  File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
TypeError: can not serialize 'datetime.datetime' object
11-10-2025 17:28:05 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:28:05 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    |     tokens = await stamp_tokens(response, userdata, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 23, in stamp_tokens
    |     await add_session(userdata=userdata.get('username'),
    |                       refresh_token=session.refresh_token,
    |                       session=session.session)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    |     await r.hset(userdata, refresh_token, packb(session.model_dump()))
    |                                           ~~~~~^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    |     return Packer(**kwargs).pack(o)
    |            ~~~~~~~~~~~~~~~~~~~~~^^^
    |   File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
    | TypeError: can not serialize 'datetime.datetime' object
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    tokens = await stamp_tokens(response, userdata, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 23, in stamp_tokens
    await add_session(userdata=userdata.get('username'),
                      refresh_token=session.refresh_token,
                      session=session.session)
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    await r.hset(userdata, refresh_token, packb(session.model_dump()))
                                          ~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    return Packer(**kwargs).pack(o)
           ~~~~~~~~~~~~~~~~~~~~~^^^
  File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
TypeError: can not serialize 'datetime.datetime' object
11-10-2025 17:28:18 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:28:18 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    |     tokens = await stamp_tokens(response, userdata, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 23, in stamp_tokens
    |     await add_session(userdata=userdata.get('username'),
    |                       refresh_token=session.refresh_token,
    |                       session=session.session)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    |     await r.hset(userdata, refresh_token, packb(session.model_dump()))
    |                                           ~~~~~^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    |     return Packer(**kwargs).pack(o)
    |            ~~~~~~~~~~~~~~~~~~~~~^^^
    |   File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
    | TypeError: can not serialize 'datetime.datetime' object
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    tokens = await stamp_tokens(response, userdata, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 23, in stamp_tokens
    await add_session(userdata=userdata.get('username'),
                      refresh_token=session.refresh_token,
                      session=session.session)
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    await r.hset(userdata, refresh_token, packb(session.model_dump()))
                                          ~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    return Packer(**kwargs).pack(o)
           ~~~~~~~~~~~~~~~~~~~~~^^^
  File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
TypeError: can not serialize 'datetime.datetime' object
11-10-2025 17:30:24 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:30:25 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<3 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    |     tokens = await stamp_tokens(response, userdata, useragent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 22, in stamp_tokens
    |     await add_session(userdata=userdata.get('username'),
    |                       refresh_token=session.refresh_token,
    |                       session=session.session)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    |     await r.hset(userdata, refresh_token, packb(session.model_dump()))
    |                                           ~~~~~^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    |     return Packer(**kwargs).pack(o)
    |            ~~~~~~~~~~~~~~~~~~~~~^^^
    |   File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
    |   File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
    |   File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
    | TypeError: can not serialize 'datetime.datetime' object
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 34, in login
    tokens = await stamp_tokens(response, userdata, useragent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 22, in stamp_tokens
    await add_session(userdata=userdata.get('username'),
                      refresh_token=session.refresh_token,
                      session=session.session)
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\redis_repository.py", line 7, in add_session
    await r.hset(userdata, refresh_token, packb(session.model_dump()))
                                          ~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\msgpack\__init__.py", line 36, in packb
    return Packer(**kwargs).pack(o)
           ~~~~~~~~~~~~~~~~~~~~~^^^
  File "msgpack/_packer.pyx", line 279, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 276, in msgpack._cmsgpack.Packer.pack
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 213, in msgpack._cmsgpack.Packer._pack_inner
  File "msgpack/_packer.pyx", line 270, in msgpack._cmsgpack.Packer._pack
  File "msgpack/_packer.pyx", line 257, in msgpack._cmsgpack.Packer._pack_inner
TypeError: can not serialize 'datetime.datetime' object
11-10-2025 17:32:06 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:32:08 - app.api.middleware.middleware - INFO - Outgoing response code: 200
11-10-2025 17:33:09 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:33:12 - app.api.middleware.middleware - INFO - Outgoing response code: 200
11-10-2025 17:34:20 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:34:23 - app.api.middleware.middleware - INFO - Outgoing response code: 200
11-10-2025 17:35:06 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:35:09 - app.api.middleware.middleware - INFO - Outgoing response code: 200
11-10-2025 17:35:19 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
11-10-2025 17:35:19 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 43, in check_token
    |     tokens = await update_tokens(response, request, user_agent)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 55, in update_tokens
    |     token = await stamp_tokens(response, userdata, user_agent)
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 19, in stamp_tokens
    |     userdata.pop('register_date')
    |     ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
    | KeyError: 'register_date'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 43, in check_token
    tokens = await update_tokens(response, request, user_agent)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 55, in update_tokens
    token = await stamp_tokens(response, userdata, user_agent)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 19, in stamp_tokens
    userdata.pop('register_date')
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
KeyError: 'register_date'
11-10-2025 17:37:23 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
11-10-2025 17:37:25 - app.api.middleware.middleware - INFO - Outgoing response code: 200
11-10-2025 17:37:34 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
11-10-2025 17:37:34 - app.api.middleware.middleware - INFO - Outgoing response code: 200
11-10-2025 17:37:48 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
11-10-2025 17:37:48 - app.api.middleware.middleware - INFO - Outgoing response code: 200
11-10-2025 17:37:54 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
11-10-2025 17:37:54 - app.api.middleware.middleware - INFO - Outgoing response code: 200
11-10-2025 17:37:58 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
11-10-2025 17:37:58 - app.api.middleware.middleware - INFO - Outgoing response code: 200
12-10-2025 15:28:13 - app.api.middleware.middleware - INFO - Incoming request: GET /tasks/create_task
12-10-2025 15:28:13 - app.api.middleware.middleware - INFO - Outgoing response code: 405
12-10-2025 15:28:17 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
12-10-2025 15:28:17 - app.api.middleware.middleware - INFO - Outgoing response code: 401
12-10-2025 15:28:56 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
12-10-2025 15:28:56 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 521, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        operation, self._invalidate_schema_cache_asof
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 768, in _prepare
    prepared_stmt = await self._connection.prepare(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        operation, name=self._prepared_statement_name_func()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\asyncpg\connection.py", line 635, in prepare
    return await self._prepare(
           ^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\asyncpg\connection.py", line 653, in _prepare
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\asyncpg\connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "asyncpg\\protocol\\protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedTableError: relation "users" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedTableError'>: relation "users" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 27, in login
    userdata: [dict | None] = await service.get_by_username(username=credentials.username)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\service\users_service.py", line 30, in get_by_username
    data = await self.uow.model.find_one(username=username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\repositories\base_repository.py", line 50, in find_one
    result = await self.session.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "users" does not exist
[SQL: SELECT users.id, users.username, users.password, users.register_date, users.role 
FROM users 
WHERE users.username = $1::VARCHAR]
[parameters: ('elina',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
12-10-2025 15:29:05 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
12-10-2025 15:29:05 - app.api.middleware.middleware - INFO - Outgoing response code: 401
12-10-2025 15:29:32 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
12-10-2025 15:29:32 - app.api.middleware.middleware - INFO - Outgoing response code: 401
12-10-2025 15:29:34 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
12-10-2025 15:29:34 - app.api.middleware.middleware - INFO - Outgoing response code: 401
12-10-2025 15:29:37 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
12-10-2025 15:29:38 - app.api.middleware.middleware - INFO - Outgoing response code: 401
12-10-2025 15:29:42 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
12-10-2025 15:29:42 - app.api.middleware.middleware - INFO - Outgoing response code: 401
12-10-2025 15:30:00 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
12-10-2025 15:30:02 - app.api.middleware.middleware - INFO - Outgoing response code: 200
12-10-2025 15:30:20 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
12-10-2025 15:30:20 - app.api.middleware.middleware - INFO - Outgoing response code: 422
12-10-2025 15:31:34 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
12-10-2025 15:31:34 - app.api.middleware.middleware - INFO - Outgoing response code: 422
12-10-2025 15:32:04 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
12-10-2025 15:32:05 - app.api.middleware.middleware - INFO - Outgoing response code: 401
12-10-2025 15:34:51 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
12-10-2025 15:34:54 - app.api.middleware.middleware - INFO - Outgoing response code: 401
12-10-2025 15:37:15 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
12-10-2025 15:37:17 - app.api.middleware.middleware - INFO - Outgoing response code: 401
12-10-2025 15:37:47 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
12-10-2025 15:37:49 - app.api.middleware.middleware - INFO - Outgoing response code: 401
12-10-2025 15:40:17 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
12-10-2025 15:40:19 - app.api.middleware.middleware - INFO - Outgoing response code: 200
12-10-2025 15:40:44 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
12-10-2025 15:40:44 - app.api.middleware.middleware - INFO - Outgoing response code: 401
12-10-2025 15:40:47 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
12-10-2025 15:40:47 - app.api.middleware.middleware - INFO - Outgoing response code: 200
12-10-2025 15:42:50 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
12-10-2025 15:42:50 - app.api.middleware.middleware - INFO - Outgoing response code: 401
12-10-2025 15:42:56 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
12-10-2025 15:42:56 - app.api.middleware.middleware - INFO - Outgoing response code: 401
14-10-2025 18:12:05 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
14-10-2025 18:12:05 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
  + Exception Group Traceback (most recent call last):
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 76, in collapse_excgroups
  |     yield
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 174, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ~~~~~~~~~~~~~~~~~~~~~~~^^
  |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  |         "unhandled errors in a TaskGroup", self._exceptions
  |     ) from None
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    |     await self.app(scope, receive, _send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ~~~~~~~~~~~~~~~~~~^^
    |   File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    |     self.gen.throw(value)
    |     ~~~~~~~~~~~~~~^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    |     response = await call_next(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    |     raise app_exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    |     await route.handle(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    |     await self.app(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    |     solved_result = await solve_dependencies(
    |                     ^^^^^^^^^^^^^^^^^^^^^^^^^
    |     ...<6 lines>...
    |     )
    |     ^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    |     solved = await call(**solved_result.values)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 39, in check_token
    |     tokens: Tokens = await get_tokens(request)
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 34, in get_tokens
    |     return Tokens(refresh_token=refresh_token, access_token=session_token)
    |   File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 243, in __init__
    |     validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
    | pydantic_core._pydantic_core.ValidationError: 1 validation error for Tokens
    | access_token
    |   Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    |     For further information visit https://errors.pydantic.dev/2.11/v/string_type
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 291, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\dependencies\utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 39, in check_token
    tokens: Tokens = await get_tokens(request)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\security.py", line 34, in get_tokens
    return Tokens(refresh_token=refresh_token, access_token=session_token)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\pydantic\main.py", line 243, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for Tokens
access_token
  Input should be a valid string [type=string_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
14-10-2025 18:13:36 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
14-10-2025 18:13:38 - app.api.middleware.middleware - INFO - Outgoing response code: 401
14-10-2025 18:13:44 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
14-10-2025 18:13:44 - app.api.middleware.middleware - INFO - Outgoing response code: 200
14-10-2025 18:13:54 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
14-10-2025 18:13:54 - app.api.middleware.middleware - INFO - Outgoing response code: 401
14-10-2025 18:14:41 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
14-10-2025 18:14:43 - app.api.middleware.middleware - INFO - Outgoing response code: 401
14-10-2025 18:15:42 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
14-10-2025 18:15:44 - app.api.middleware.middleware - INFO - Outgoing response code: 401
14-10-2025 18:18:56 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
14-10-2025 18:18:58 - app.api.middleware.middleware - INFO - Outgoing response code: 401
14-10-2025 18:19:31 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
14-10-2025 18:19:33 - app.api.middleware.middleware - INFO - Outgoing response code: 200
14-10-2025 18:19:53 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
14-10-2025 18:19:53 - app.api.middleware.middleware - INFO - Outgoing response code: 401
14-10-2025 18:25:40 - app.api.middleware.middleware - INFO - Incoming request: POST /tasks/create_task
14-10-2025 18:25:42 - app.api.middleware.middleware - INFO - Outgoing response code: 200
06-11-2025 11:01:49 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
06-11-2025 11:01:49 - app.api.middleware.middleware - ERROR - Alarm! Global exception!
Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 521, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        operation, self._invalidate_schema_cache_asof
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 768, in _prepare
    prepared_stmt = await self._connection.prepare(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        operation, name=self._prepared_statement_name_func()
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\asyncpg\connection.py", line 635, in prepare
    return await self._prepare(
           ^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\asyncpg\connection.py", line 653, in _prepare
    stmt = await self._get_statement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\asyncpg\connection.py", line 432, in _get_statement
    statement = await self._protocol.prepare(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<5 lines>...
    )
    ^
  File "asyncpg\\protocol\\protocol.pyx", line 165, in prepare
asyncpg.exceptions.UndefinedTableError: relation "users" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedTableError'>: relation "users" does not exist

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 173, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Down\AppData\Local\Programs\Python\Python313\Lib\contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_utils.py", line 82, in collapse_excgroups
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 175, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\middleware\middleware.py", line 17, in logging_middleware
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 153, in call_next
    raise app_exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\api\auth\register.py", line 27, in login
    userdata: [dict | None] = await service.get_by_username(username=credentials.username)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\service\users_service.py", line 30, in get_by_username
    data = await self.uow.model.find_one(username=username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\app\repositories\base_repository.py", line 50, in find_one
    result = await self.session.execute(query)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self,
        ^^^^^
    ...<4 lines>...
        conn,
        ^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
        statement, params or {}, execution_options=execution_options
    )
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
        self,
        distilled_parameters,
        execution_options or NO_OPTIONS,
    )
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self, distilled_params, execution_options
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
        dialect,
    ...<8 lines>...
        cache_hit=cache_hit,
    )
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1843, in _execute_context
    return self._exec_single_context(
           ~~~~~~~~~~~~~~~~~~~~~~~~~^
        dialect, context, statement, parameters
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        e, str_statement, effective_parameters, cursor, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
    ~~~~~~~~~~~~~~~~~~~~~~~^
        cursor, str_statement, effective_parameters, context
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\engine\default.py", line 945, in do_execute
    cursor.execute(statement, parameters)
    ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 580, in execute
    self._adapt_connection.await_(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._prepare_and_execute(operation, parameters)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 558, in _prepare_and_execute
    self._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 508, in _handle_exception
    self._adapt_connection._handle_exception(error)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "C:\Users\Down\Desktop\projects\pythonProject\venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 792, in _handle_exception
    raise translated_error from error
sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedTableError'>: relation "users" does not exist
[SQL: SELECT users.id, users.username, users.password, users.register_date, users.role 
FROM users 
WHERE users.username = $1::VARCHAR]
[parameters: ('user',)]
(Background on this error at: https://sqlalche.me/e/20/f405)
06-11-2025 11:02:03 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
06-11-2025 11:02:06 - app.api.middleware.middleware - INFO - Outgoing response code: 200
06-11-2025 11:03:34 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
06-11-2025 11:03:35 - app.api.middleware.middleware - INFO - Outgoing response code: 200
06-11-2025 11:03:59 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
06-11-2025 11:03:59 - app.api.middleware.middleware - INFO - Outgoing response code: 401
06-11-2025 11:04:31 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
06-11-2025 11:04:34 - app.api.middleware.middleware - INFO - Outgoing response code: 200
06-11-2025 11:04:43 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
06-11-2025 11:04:44 - app.api.middleware.middleware - INFO - Outgoing response code: 200
06-11-2025 11:04:50 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
06-11-2025 11:04:51 - app.api.middleware.middleware - INFO - Outgoing response code: 200
06-11-2025 11:04:56 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
06-11-2025 11:04:57 - app.api.middleware.middleware - INFO - Outgoing response code: 200
06-11-2025 11:05:32 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
06-11-2025 11:05:35 - app.api.middleware.middleware - INFO - Outgoing response code: 200
06-11-2025 11:05:36 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
06-11-2025 11:05:36 - app.api.middleware.middleware - INFO - Outgoing response code: 200
06-11-2025 11:08:27 - app.api.middleware.middleware - INFO - Incoming request: POST /auth/login
06-11-2025 11:08:29 - app.api.middleware.middleware - INFO - Outgoing response code: 200
06-11-2025 11:08:37 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
06-11-2025 11:08:37 - app.api.middleware.middleware - INFO - Outgoing response code: 200
06-11-2025 11:08:49 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
06-11-2025 11:08:49 - app.api.middleware.middleware - INFO - Outgoing response code: 401
06-11-2025 11:08:51 - app.api.middleware.middleware - INFO - Incoming request: GET /currency/get_currency_codes
06-11-2025 11:08:51 - app.api.middleware.middleware - INFO - Outgoing response code: 401
